#:kivy 2.0.0
#:import utils kivy.utils

<DarkButton@Button>:
    background_normal: ''
    background_color: utils.get_color_from_hex('#383838')
    color: utils.get_color_from_hex('#eeeeee')
    font_size: '13sp'
    size_hint_y: None
    height: '30dp'
    size_hint_x: None
    width: '80dp'

<PrimaryButton@DarkButton>:
    background_color: utils.get_color_from_hex('#0e639c')

<PanelTitle@Label>:
    size_hint_y: None
    height: '25dp'
    text_size: self.size
    halign: 'left'
    valign: 'middle'
    font_size: '11sp'
    bold: True
    color: utils.get_color_from_hex('#858585')
    canvas.before:
        Color:
            rgba: utils.get_color_from_hex('#252526')
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: utils.get_color_from_hex('#2d2d2d')
        Line:
            points: [self.x, self.y, self.right, self.y]
            width: 1

<DisplayPanel@BoxLayout>:
    orientation: 'vertical'
    canvas.before:
        Color:
            rgba: utils.get_color_from_hex('#252526')
        Rectangle:
            pos: self.pos
            size: self.size

<RootLayout>:
    orientation: 'vertical'
    canvas.before:
        Color:
            rgba: utils.get_color_from_hex('#1e1e1e')  
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        size_hint_y: None
        height: '50dp'
        padding: ['15dp', '10dp']
        spacing: '15dp'
        canvas.before:
            Color:
                rgba: utils.get_color_from_hex('#333333')
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: utils.get_color_from_hex('#3e3e42')
            Line:
                points: [self.x, self.y, self.right, self.y]
                width: 1

        PrimaryButton:
            text: 'Run ->'
            size_hint_x: None
            width: '80dp'
            on_release: root.start_visualization(self)

        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 1
            
            BoxLayout:
                orientation: 'horizontal'
                spacing: '5dp'
                
                DarkButton:
                    text: '<'
                    width: '30dp'
                    on_release: root.step_visualization(-1)
                    
                PrimaryButton:
                    id: btn_play
                    text: 'Play'
                    on_release: root.toggle_play(self)
                    
                DarkButton:
                    text: '>'
                    width: '30dp'
                    on_release: root.step_visualization(1)
                    
                Slider:
                    id: step_scrubber
                    min: 0
                    max: 0
                    value: 0
                    step: 1
                    cursor_size: ('15dp', '15dp')
                    on_value: root.render_step(int(self.value))
                    
                Label:
                    id: step_label
                    text: '0 / 0'
                    font_name: 'RobotoMono-Regular'
                    font_size: '12sp'
                    color: utils.get_color_from_hex('#858585')
                    size_hint_x: None
                    width: '60dp'
                    text_size: self.size
                    halign: 'right'
                    valign: 'middle'

        BoxLayout:
            size_hint_x: None
            width: '200dp'
            spacing: '10dp'
            Label:
                text: 'Speed:'
                font_size: '12sp'
                color: utils.get_color_from_hex('#888888')
                size_hint_x: None
                width: '40dp'
            Slider:
                id: speed_slider
                min: 0.1
                max: 2.0
                value: 1.0


    Label:
        id: error_banner
        size_hint_y: None
        height: '0dp'
        text: ''
        markup: True
        halign: 'left'
        valign: 'middle'
        text_size: self.size
        color: utils.get_color_from_hex('#ffdddd')
        canvas.before:
            Color:
                rgba: utils.get_color_from_hex('#5a1d1d')
            Rectangle:
                pos: self.pos
                size: self.size
            Color:
                rgba: utils.get_color_from_hex('#ff0000')
            Line:
                points: [self.x, self.y, self.right, self.y]
                width: 1

    BoxLayout:
        orientation: 'horizontal'
        
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.6
            
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: 0.7
                background_color: utils.get_color_from_hex('#1e1e1e')
                
                PanelTitle:
                    text: ' CODE EDITOR'
                    padding_x: '15dp'
                BoxLayout:
                    id: editor_wrapper
                    orientation: 'horizontal'
                    opacity: 1
                    
                    TextInput:
                        id: line_numbers
                        size_hint_x: None
                        width: '55dp'
                        text: '  1'
                        readonly: True
                        background_color: utils.get_color_from_hex('#1e1e1e')
                        foreground_color: utils.get_color_from_hex('#6e7681')
                        font_name: 'RobotoMono-Regular'
                        font_size: '14sp'
                        halign: 'right'
                        padding: [0, '10dp', '8dp', '10dp']
                        cursor_color: (0, 0, 0, 0)
                        scroll_y: code_input.scroll_y

                    CodeInput:
                        id: code_input
                        lexer: __import__('pygments.lexers.python').lexers.python.PythonLexer()
                        style_name: 'monokai'
                        text: ''
                        background_color: utils.get_color_from_hex('#1e1e1e')
                        foreground_color: utils.get_color_from_hex('#c9d1d9')
                        cursor_color: utils.get_color_from_hex('#58a6ff')
                        font_name: 'RobotoMono-Regular'
                        font_size: '14sp'
                        auto_indent: True
                        readonly: False
                        padding: ['15dp', '10dp']

                ScrollView:
                    id: trace_wrapper
                    do_scroll_x: True
                    do_scroll_y: True
                    opacity: 0
                    size_hint_y: None
                    height: 0
                    
                    BoxLayout:
                        orientation: 'horizontal'
                        size_hint: None, None
                        height: max(trace_line_numbers.texture_size[1], code_display.texture_size[1])
                        width: max(trace_wrapper.width, trace_line_numbers.width + code_display.texture_size[0])
                        
                        Label:
                            id: trace_line_numbers
                            size_hint: None, None
                            size: '55dp', self.texture_size[1]
                            text_size: self.width, None
                            pos_hint: {'top': 1}
                            text: ''
                            color: utils.get_color_from_hex('#6e7681')
                            font_name: 'RobotoMono-Regular'
                            font_size: '14sp'
                            halign: 'right'
                            valign: 'top'
                            padding: ['8dp', '8dp']
                            markup: True

                        Label:
                            id: code_display
                            text: ''
                            markup: True
                            color: utils.get_color_from_hex('#d4d4d4')
                            text_size: max(self.width, self.texture_size[0]), None
                            size_hint: None, None
                            size: max(self.parent.width - trace_line_numbers.width, self.texture_size[0]), self.texture_size[1]
                            pos_hint: {'top': 1}
                            halign: 'left'
                            valign: 'top'
                            font_name: 'RobotoMono-Regular'
                            font_size: '14sp'
                            padding: ['15dp', '8dp']

            BoxLayout:
                orientation: 'vertical'
                size_hint_y: 0.3
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#181818')
                    Rectangle:
                        pos: self.pos
                        size: self.size
                    Color:
                        rgba: utils.get_color_from_hex('#3e3e42')
                    Line:
                        points: [self.x, self.top, self.right, self.top]
                        width: 1

                PanelTitle:
                    text: ' TERMINAL / OUTPUT'
                    padding_x: '15dp'
                    
                ScrollView:
                    do_scroll_x: True
                    do_scroll_y: True
                    Label:
                        id: output_display
                        text: ''
                        color: utils.get_color_from_hex('#dcdcdc')
                        text_size: None, None
                        size_hint: None, None
                        size: self.texture_size
                        halign: 'left'
                        valign: 'top'
                        font_name: 'RobotoMono-Regular'
                        font_size: '13sp'
                        padding: ['10dp', '10dp']


        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.4
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#3e3e42')
                Line:
                    points: [self.x, self.y, self.x, self.top]
                    width: 1

            DisplayPanel:
                size_hint_y: 0.6
                PanelTitle:
                    text: ' VARIABLES'
                    padding_x: '15dp'
                ScrollView:
                    do_scroll_x: True
                    do_scroll_y: True
                    Label:
                        id: variable_display
                        text: ''
                        color: utils.get_color_from_hex('#cccccc')
                        text_size: None, None
                        size_hint: None, None
                        size: self.texture_size
                        halign: 'left'
                        valign: 'top'
                        font_name: 'RobotoMono-Regular'
                        font_size: '13sp'
                        padding: ['10dp', '10dp']
                        markup: True

            DisplayPanel:
                size_hint_y: 0.4
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#3e3e42')
                    Line:
                        points: [self.x, self.top, self.right, self.top]
                        width: 1
                PanelTitle:
                    text: ' CALL STACK'
                    padding_x: '15dp'
                ScrollView:
                    do_scroll_x: True
                    do_scroll_y: True
                    Label:
                        id: memory_display
                        text: ''
                        color: utils.get_color_from_hex('#aaaaaa')
                        text_size: None, None
                        size_hint: None, None
                        size: self.texture_size
                        halign: 'left'
                        valign: 'top'
                        font_name: 'RobotoMono-Regular'
                        font_size: '13sp'
                        padding: ['12dp', '6dp']
                        markup: True
